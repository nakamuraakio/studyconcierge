<div class="container-fluid">
<div class="row">

<div class="menu col-md-3">
<%= render 'home/menu' %>
</div>

<div class = "col-md-9">
<h3>サマリー</h3>
<div class = "panel panel-default" >
<div class = "panel-body panel-scroll">
<% @summary.reports.each do |report| %>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><%= report.created_at.strftime('%Y年%m月%d日 %A') %></h3>
  </div>

  <div class = "panel-body">
    <div class="progress center-block" style="width: 80%">
      <div class="progress-bar progress-bar-danger" style="width: <%= (report.japanese_percentage+report.old_japanese_percentage+report.old_chinese_percentage) %>%">
        <%= (report.japanese_percentage+report.old_japanese_percentage+report.old_chinese_percentage) %>%
      </div>
      <div class="progress-bar progress-bar-info" style="width: <%= (report.math_percentage) %>%">
        <%= (report.math_percentage) %>%
      </div>
      <div class="progress-bar progress-bar-warning" style="width: <%= (report.english_percentage) %>%">
        <%= (report.english_percentage) %>%
      </div>
      <div class="progress-bar progress-bar-default" style="width: <%= (report.world_history_percentage+report.japanese_history_percentage+report.geography_percentage+report.politics_and_economics_percentage+report.ethics_percentage+report.modern_society_percentage) %>%">
        <%= (report.world_history_percentage+report.japanese_history_percentage+report.geography_percentage+report.politics_and_economics_percentage+report.ethics_percentage+report.modern_society_percentage) %>%
      </div>
      <div class="progress-bar progress-bar-success" style="width: <%= (report.chemistry_percentage+report.physics_percentage+report.biology_percentage+report.geology_percentage) %>%">
        <%= (report.chemistry_percentage+report.physics_percentage+report.biology_percentage+report.geology_percentage) %>%
      </div>
    </div>

    <div class = "col-md-8">

      <table class = "table">
        <% if current_user.subject.japanese %>
          <tr>
            <th class = "col-md-3">現代文</th>
            <td class = "col-md-2"><%= report.japanese_percentage %>%</td>
            <td><%= report.japanese_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.old_japanese %>
          <tr>
            <th>古文</th>
            <td><%= report.old_japanese_percentage %>%</td>
            <td><%= report.old_japanese_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.old_chinese %>
          <tr>
            <th>漢文</th>
            <td><%= report.old_chinese_percentage %>%</td>
            <td><%= report.old_chinese_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.english %>
          <tr>
            <th>英語</th>
            <td><%= report.english_percentage %>%</td>
            <td><%= report.english_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.math %>
          <tr>
            <th>数学</th>
            <td><%= report.math_percentage %>%</td>
            <td><%= report.math_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.physics %>
          <tr>
            <th>物理</th>
            <td><%= report.physics_percentage %>%</td>
            <td><%= report.physics_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.chemistry %>
          <tr>
            <th>化学</th>
            <td><%= report.chemistry_percentage %>%</td>
            <td><%= report.chemistry_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.biology %>
          <tr>
            <th>生物</th>
            <td><%= report.biology_percentage %>%</td>
            <td><%= report.biology_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.geology %>
          <tr>
            <th>地学</th>
            <td><%= report.geology_percentage %>%</td>
            <td><%= report.geology_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.world_history %>
          <tr>
            <th>世界史</th>
            <td><%= report.world_history_percentage %>%</td>
            <td><%= report.world_history_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.japanese_history %>
          <tr>
            <th>日本史</th>
            <td><%= report.japanese_history_percentage %>%</td>
            <td><%= report.japanese_history_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.politics_and_economics %>
          <tr>
            <th>政治経済</th>
            <td><%= report.politics_and_economics_percentage %>%</td>
            <td><%= report.politics_and_economics_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.modern_society %>
          <tr>
            <th>現代社会</th>
            <td><%= report.modern_society_percentage %>%</td>
            <td><%= report.modern_society_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.ethics %>
          <tr>
            <th>倫理</th>
            <td><%= report.ethics_percentage %>%</td>
            <td><%= report.ethics_comment %></td>
          </tr>
        <% end %>

        <% if current_user.subject.geography %>
          <tr>
            <th>地理</th>
            <td><%= report.geography_percentage %>%</td>
            <td><%= report.geography_comment %></td>
          </tr>
        <% end %>
        <tr>
          <th>今日の勉強時間:</th>
          <td><%= report.average_studytime %>時間</td>
          <td></td>
        </tr>

        <tr>
          <th>コメント:</th>
          <td><%= report.free_comment %></td>
          <td></td>
        </tr>
      </table>
    </div>
  </div>
</div>
<% end %>
</div>
</div>

<div class = "comment">
<% if @comments %>
  <% @comments.each do |comment| %>
    <% if comment.created_by_user %>
      <div class="panel panel-default panel-comment-user panel-info">
        <div class="panel-heading">
          <h3 class="panel-title"><%= comment.user.name %>さん <%= comment.created_at.strftime('%Y年%m月%d日 %A') %> <span class = "badge"><%= comment.comment_count %></span></h3>
        </div>
        <div class = "panel-body">
          <p><%= simple_format(comment.content) %></p>
          <% #if comment.created_by_user %>
            <%#= link_to '削除', comment, method: :delete, data: { confirm: 'コメントを削除してよろしいですか？' } %>
            <% #if comment.read_flag %>
              <!--<p>既読</p>-->
            <% #end %>
          <% #end %>
        </div>
      </div>
      
      <%= image_tag url_for(:controller => 'users/registrations', :action => 'photo', :id => current_user.id), :height => '100', :width => '100', :class => 'img-circle', :style => "float:right; vertical-align:middle; margin-right:3%" %>
    <% else %>
      <%= image_tag url_for(:controller => 'tutors/registrations', :action => 'photo', :id => comment.tutor.id), :height => '100', :width => '100', :class => 'img-circle', :style => "float:left; vertical-align:middle; margin-left:3%" %>
      <div class="panel panel-default panel-comment-tutor panel-warning">
        <div class="panel-heading">
          <h3 class="panel-title"><%= comment.tutor.name %>チューター <%= comment.created_at.strftime('%Y年%m月%d日 %A') %> <span class = "badge"><%= comment.comment_count %></h3>
        </div>
        <div class = "panel-body">
          <p><%= simple_format(comment.content) %></p>
          <% if comment.created_by_user %>
            <%= link_to '削除', comment, method: :delete, data: { confirm: 'コメントを削除してよろしいですか？' } %>
            <% if comment.read_flag %>
              <p>既読</p>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>
</div>
<% if @summary.comments.count > 7 %>
  <div class="alert alert-danger" style="clear:both;">
    <p>コメント数の上限に到達しました。</p>
  </div>
<% elsif @summary.user.tutor_id == 0 %>
  <div class="alert alert-danger" style="clear:both;">
    <p>チューターが未登録なため現在コメント機能はご利用いただけません。</p>
  </div>
<% elsif @summary.user.tutor != @summary.comments.first.tutor %>
  <div class="alert alert-danger" style="clear:both;">
    <p>チューターが変更されたため本報告のコメント機能はご利用いただけません。</p>
  </div>
<% elsif @summary.comments.count % 2 == 0 %>
  <div class="alert alert-danger" style="clear:both;">
    <p>チューターからの返信待ちです。</p>
  </div>
<% else %>
  <div class="panel panel-default" style="clear:both;padding:10px;">
    <%= render 'comments/form' %>
  </div>
<% end %>


<% link_to '一覧に戻る', summaries_path %>
</div>
</div>

</div>
